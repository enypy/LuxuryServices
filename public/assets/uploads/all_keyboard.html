<!-- last edit 17.05.17 -->

<link href="style.css" rel="stylesheet" type="text/css">
<meta http-equiv="Content-Type" content="text/html; charset=windows-1251" />

<p class="title">Процедуры и функции работы с клавиатурой</p>

<p>
В этом разделе описаны процедуры и функции работы с клавиатурой. Все, что вам необходимо знать - это то, что у каждой клавиши
на клавиатуре есть свой числовой код. К примеру для пробела это 32. Эти коды перечислены в Приложении 1.<br>
Стоит понимать, что под нажатием в данном случае понимается программное сообщение (виртуальное нажатие), поведение которого иногда может отличаться от реального нажатия клавиши на клавиатуре.
</p>


<p class="title">Содержание</p>

<ul>
<li><a href=#KEYPRESS>KEYPRESS</a>
<li><a href=#KEYDOWN>KEYDOWN</a>
<li><a href=#KEYUP>KEYUP</a>
<li><a href=#KEYSTRING>KEYSTRING</a>
<li><a href=#ISKEYDOWN>ISKEYDOWN</a>
<li><a href=#GETKBLAYOUT>GETKBLAYOUT</a>
<li><a href=#SETKBLAYOUT>SETKBLAYOUT</a>
<li><a href=#GETKEYSDOWN>GETKEYSDOWN</a>
</ul>

<!-- ----------- -->

<a name="KEYPRESS"></a><p class="subtitle">KEYPRESS</p>
<p>Нажимает и отпускает клавишу клавиатуры.</p>

<b>Синтаксис</b><br>
<p>
<b class="func_name">KEYPRESS</b> (<i class="par_num">keycode</i>)
</p>

<br>

<b>Параметры</b>
<p>
<i class="par_num">keycode</i> - код клавиши
</p>

<br>

<b>Пример</b>
<p>
<pre>
// нажатие пробела
keypress(32)

// нажатие с использованием константы
keypress(#space)
</pre>
</p>

<br>

<!-- ----------- -->

<a name="KEYDOWN"></a><p class="subtitle">KEYDOWN</p>
<p>Нажимает и удерживает клавишу клавиатуры.</p>

<b>Синтаксис</b><br>
<p>
<b class="func_name">KEYDOWN</b> (<i class="par_num">keycode</i>)
</p>

<br>

<b>Параметры</b>
<p>
<i class="par_num">keycode</i> - код клавиши
</p>

<br>

<b>Пример</b>
<p>
<pre>
// нажатие комбинации Ctrl + S
keydown(#ctrl)
keypress(#S)
keyup(#ctrl)
</pre>
</p>

<br>

<b>Примечания</b>
<p>
Зажать с постоянным повторением клавишу по аналогии с реальной клавиатурой таким способом не получится, так как в реальной клавиатуре за эту функцию отвечает контроллер.
</p>



<!-- ----------- -->

<a name="KEYUP"></a><p class="subtitle">KEYUP</p>
<p>Отжимает ранее зажатую клавишу клавиатуры.</p>

<b>Синтаксис</b><br>
<p>
<b class="func_name">KEYUP</b> (<i class="par_num">keycode</i>)
</p>

<br>

<b>Параметры</b>
<p>
<i class="par_num">keycode</i> - код клавиши
</p>

<!-- ----------- -->

<a name="KEYSTRING"></a><p class="subtitle">KEYSTRING</p>
<p>Нажимает клавиши соответственно символам входной строки.</p>

<b>Синтаксис</b><br>
<p>
<b class="func_name">KEYSTRING</b> (<i class="par_str">keystring</i>, [<i class="par_num">delay</i>] )
</p>

<br>

<b>Параметры</b>
<p>
<i>keystring</i> - входная строка<br>
<i>delay</i> - необязательный параметр; задержка в милисекундах между каждым набором символа
</p>

<br>

<b>Пример</b>
<p>
<pre>
keystring("hello world")
</pre>
</p>

<br>

<b>Примечания</b>
<p>
Процедура не печатает строку в привычном понимании, а нажимает клавиши соответственно символам входной строки. Инструкция не может использоваться для нажатия несимвольных клавиш. На результат так же влияет текущая раскладка клавиатуры.
</p>

<!-- ----------- -->

<a name="ISKEYDOWN"></a><p class="subtitle">ISKEYDOWN</p>
<p>Функция. Возвращает 1 если в момент вызова функции зажата указанная клавиша и 0 - если нет.</p>


<b>Синтаксис</b><br>
<p>
<b class="func_name">ISKEYDOWN</b> (<i class="par_num">keycode</i>)
</p>

<br>

<b>Параметры</b>
<p>
<i class="par_num">keycode</i> - код клавиши
</p>

<br>

<b>Пример</b>
<p>
<pre>
// проверка нажатия пробела
if ( iskeydown(#space)=1 )
 logwrite("space!")
end_if

// проверка нажатия пробела и клавиши A
if ( (iskeydown(#space)=1) & (iskeydown(#a)=1) )
 logwrite("space and a!")
end_if
</pre>
</p>


<br>

<b>Примечания</b>
<p>
Этой функцией можно так же проверить состояние кнопок мыши (см. Приложение 1).
</p>

<!-- ----------- -->

<a name="GETKBLAYOUT"></a><p class="subtitle">GETKBLAYOUT</p>
<p>Функция. Возвращает идентификатор языка ввода (раскладки) в конкретном окне.</p>

<b>Синтаксис</b><br>
<p>
<b class="func_name">GETKBLAYOUT</b> (<i class="par_num">hwnd</i>)
</p>

<br>

<b>Параметры</b>
<p>
<i class="par_num">hwnd</i> - hwnd окна
</p>

<br>

<b>Пример</b>
<p>
<pre>
// получаем hwnd запущеной программы
$hwnd = wndfind("Блокнот")

// выводим раскладку
print( getkblayout($hwnd) ) 
</pre>
</p>

<br>

<b>Примечания</b>
<p>
В современных операционных системах Windows каждое окно хранит свою собственную раскладку.
</p>

<!-- ----------- -->

<a name="SETKBLAYOUT"></a><p class="subtitle">SETKBLAYOUT</p>
<p>Устанавливает языка ввода (раскладки) в конкретном окне.</p>

<b>Синтаксис</b><br>
<p>
<b class="func_name">SETKBLAYOUT</b> (<i class="par_num">hwnd</i>, <i class="par_num">lang</i>)
</p>

<br>

<b>Параметры</b>
<p>
<i class="par_num">hwnd</i> - hwnd окна<br>
<i class="par_num">lang</i> - идентификатор языка ввода<br>
</p>

<br>

<b>Пример</b>
<p>
<pre>
$hwnd = wndfind("Блокнот")

// английский
setkblayout($hwnd, 1033)
</pre>
</p>

<!-- ----------- -->

<a name="GETKEYSDOWN"></a><p class="subtitle">GETKEYSDOWN</p>
<p>Помещает список зажатых в момент вызова клавиш в массив.</p>

<b>Синтаксис</b><br>
<p>
<b class="func_name">GETKEYSDOWN</b> (<i class="par_var">$arr</i>)
</p>

<br>

<b>Параметры</b>
<p>
<i>$arr</i> - входной массив
</p>

<br>

<b>Пример</b>
<p>
<pre>
// пример 1, вывод в лог кодов всех нажатых клавиш
getkeysdown($kvar)

for($i=0, $i < arrsize($kvar))
	print($kvar[$i])
end_cyc

waitms(100)
logclear


// пример 2, анализ нажатых клавиш через switch
// данный пример использует тот факт что $kvar тоже самое что и $kvar[0]
getkeysdown($kvar)

SWITCH($kvar)
CASE(#q)
   print("Q")
CASE(#w)
   print("W")
CASE(#e)
   print("E")
END_SWITCH

waitms(100)
</pre>
</p>

<br>

<b>Примечания</b>
<p>
При вызове входной массив каждый раз очищается. Нажатые клавиши помещаются в массив по порядку, согласно их кодам (см. Приложение 1). Аналогично <b class="func_name">iskeydown</b>, поддерживаются как клавиши мыши, так и клавиатуры.
</p>
